<!DOCTYPE html>
<html lang='en' xml:lang='en' xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <meta content='text/html;charset=UTF-8' http-equiv='content-type'>
    <title>Right-angle phylogram with d3</title>
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.2.min.js" type="text/javascript"></script>
    <script src="https://raw.github.com/mbostock/d3/master/d3.v2.js" type="text/javascript"></script>
    <script src="https://raw.github.com/mtrpcic/pathjs/master/path.min.js" type="text/javascript"></script>
    <script src="newick.js" type="text/javascript"></script>
    <script src="d3.phylogram.js" type="text/javascript"></script>
    <script>
       function parse_and_build_tree(tree) {
          var newick = Newick.parse(tree);
          var newickNodes = [];
          function buildNewickNodes(node, callback) {
             newickNodes.push(node);
             if (node.branchset) {
                for (var i=0; i < node.branchset.length; i++) {
                   buildNewickNodes(node.branchset[i]);
                }
             }
          }
          buildNewickNodes(newick);
          return newick;
       }

       function display_radial(newick) {
          d3.select("#phylogram svg").remove();
          d3.phylogram.buildRadial('#radialtree', newick, {
             width: 400,
             skipLabels: true
          })
       }
       function display_phylogram(newick) {
          d3.select("#phylogram svg").remove();
          d3.phylogram.build('#phylogram', newick, {
             width: 300,
             height: 400
          });
       }

       function add_tree_in_list(name) {
          $('#list ul').append(
          $('<li>').append(
          $('<a>').attr('href', '#/' + name + '.txt').append(
             name
             )
             )
             );
          }

          $(function () {
             Path.map("#/:name").to(function() {
                var filename = this.params['name'];
                $.ajax("trees/" + filename).done(function(data) {
                   var tree = parse_and_build_tree(data);
                   display_phylogram(tree);
                });
             });

             $.ajax("trees/index.list").done(function(data) {
                var names = data.split(/\n+/);
                for (var i=0; i < names.length; i++) {
                   var name = names[i];
                   if (! name.match(/^\s*$/)) {
                      add_tree_in_list(name);
                   }
                }
             });

             Path.listen();
          });

    </script>
    <style type="text/css" media="screen">
      body { font-family: "Helvetica Neue", Helvetica, sans-serif; }
      td { vertical-align: top; }
    </style>
  </head>
  <body>
     <h2>Phylogram</h2>
     <div id='phylogram'></div>
     <div id='list'><ul></ul></div>
  </body>
</html>
